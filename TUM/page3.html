<!doctype html>
<html lang="en" data-theme="light" style="">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Formulation I: Depth-Ray Representation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=Poppins:wght@500;600;700&amp;family=Roboto+Mono:wght@400;500;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
      integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
      integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        width: 1280px;
        height: 720px;
        overflow: hidden;
        font-family: "Inter", sans-serif;
        background-color: #ffffff;
      }
      .slide-container {
        width: 1280px;
        height: 720px;
        display: flex;
        flex-direction: column;
        position: relative;
        background-color: #fafafa;
      }
      .header-bar {
        height: 60px;
        display: flex;
        align-items: center;
        padding: 0 40px;
        background: white;
        border-bottom: 1px solid #e5e7eb;
      }
      .main-content {
        flex: 1;
        display: flex;
        padding: 20px 40px 12px;
        gap: 24px;
        overflow: hidden;
      }
      .left-col {
        flex: 1.1;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .right-col {
        flex: 0.9;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .section-card {
        background: white;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
        border: 1px solid #e5e7eb;
      }
      .concept-item {
        display: flex;
        gap: 16px;
        margin-bottom: 12px;
      }
      .concept-icon {
        width: 32px;
        height: 32px;
        background: #eff6ff;
        color: #2563eb;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .insight-box {
        background: #1e3a8a;
        color: white;
        border-radius: 12px;
        padding: 16px;
        position: relative;
        overflow: hidden;
      }
      .insight-box::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 150px;
        height: 100%;
        background: rgba(255, 255, 255, 0.05);
        transform: skewX(-20deg);
      }
      .equation-display {
        background: #f8fafc;
        border-left: 4px solid #2563eb;
        padding: 24px;
        border-radius: 0 12px 12px 0;
        margin-bottom: 16px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
      }
      .math-main {
        font-family: "Roboto Mono", monospace;
        font-size: 1.5rem;
        color: #1e293b;
        font-weight: 700;
        text-align: center;
        margin-bottom: 12px;
      }
      .math-sub {
        font-family: "Roboto Mono", monospace;
        font-size: 0.9rem;
        color: #64748b;
        text-align: center;
      }
      .diagram-container {
        flex: 1;
        background: white;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        padding: 20px;
        position: relative;
        display: flex;
        flex-direction: column;
      }
      #geometryCanvas {
        width: 100%;
        height: 100%;
      }
      .anticipation-note {
        background: #fffbeb;
        border: 1px solid #fcd34d;
        border-radius: 8px;
        padding: 12px 16px;
        margin-top: auto;
      }
      @page {
        size: 1280px 720px;
        margin: 0;
      }
      @media print {
        body,
        .slide-container {
          width: 1280px !important;
          height: 720px !important;
          margin: 0 !important;
          padding: 0 !important;
        }
      }
    </style>
  </head>
  <body style="margin: 0px; padding: 0px">
    <div class="slide-container">
      <!-- Header -->
      <div class="header-bar">
        <div class="flex items-center gap-4">
          <div
            class="bg-blue-600 text-white w-10 h-10 rounded flex items-center justify-center font-bold font-mono text-xl shadow-md"
          >
            3
          </div>
          <h1 class="text-2xl font-bold text-gray-900 font-poppins">
            Formulation I: Depth-Ray Representation
          </h1>
        </div>
        <div class="ml-auto flex items-center gap-2 text-gray-500 text-sm">
          <i class="fas fa-cube"></i>
          <span>Sec 3.1 Formulation</span>
        </div>
      </div>
      <!-- Main Content -->
      <div class="main-content">
        <!-- Left Column: Theoretical Concepts -->
        <div class="left-col">
          <!-- Input Setup -->
          <div class="section-card" style="padding-bottom: 0px">
            <h2 class="text-lg font-bold mb-4 font-poppins text-gray-900">
              Problem Setup
            </h2>
            <div class="concept-item">
              <div class="concept-icon"><i class="fas fa-images"></i></div>
              <div>
                <p class="font-semibold text-gray-800 text-sm mb-1">
                  Arbitrary Visual Inputs
                </p>
                <p class="text-xs text-gray-600 leading-relaxed">
                  Input set could be given as a single image, stereo pair, or
                  video frame sequence.
                </p>
              </div>
            </div>
            <div class="concept-item mb-0">
              <div class="concept-icon"><i class="fas fa-video"></i></div>
              <div>
                <p class="font-semibold text-gray-800 text-sm mb-1">
                  Per-Pixel Ray Map M
                </p>
                <p class="text-xs text-gray-600 leading-relaxed">
                  Instead of global pose, the model predicts a dense map M
                  containing ray origin t and direction d for every pixel.
                </p>
              </div>
            </div>
          </div>
          <!-- Why Avoid Rotation Constraints -->
          <div class="insight-box">
            <h2
              class="text-lg font-bold mb-3 text-white flex items-center gap-2"
            >
              <i class="fas fa-shield-alt text-blue-300"></i> Why Avoid Explicit
              Rotation?
            </h2>
            <p class="text-blue-100 text-sm mb-3 leading-relaxed">
              Directly regressing a rotation matrix
              <span class="math-inline">$R$</span> imposes an
              <strong>orthogonality constraint</strong> (<span
                class="math-inline"
                >$R^T R = I$</span
              >) that is difficult for neural networks to satisfy, often leading
              to optimization instability or degenerate poses.
            </p>
            <div
              class="flex items-center gap-2 text-xs text-blue-200 bg-blue-900 bg-opacity-40 p-2 rounded"
            >
              <i class="fas fa-check-circle text-green-400"></i>
              <span
                >Ray directions
                <span class="math-inline">$d \in \mathbb{R}^3$</span> avoid
                explicit orthogonality constraints, simplifying
                optimization.</span
              >
            </div>
          </div>
          <!-- Anticipated Question -->
          <div class="anticipation-note">
            <p class="text-xs text-amber-800 mt-1 mb-2">
              <strong>Key:</strong> Ray direction is derived from classical
              formulation as <span class="math-inline">$d = RK^{-1}p$</span>,
              linking rotation matrix and intrinsics to rays.
            </p>
            <p class="text-xs text-amber-800 font-semibold mb-1">
              Why is d unnormalized?
            </p>
            <p class="text-xs text-amber-800 leading-relaxed">
              <span class="math-inline">$d$</span> is unnormalized because
              <span class="math-inline">$||d||$</span> encodes the projection
              transformation from <span class="math-inline">$K^{-1}$</span>.
              Normalizing would decouple the scale relationship between depth
              and projection. The unnormalized
              <span class="math-inline">$d$</span> preserves the pixel-to-world
              scale factor, which is critical for geometric consistency:
              <span class="math-inline">$P = t + D \cdot d$</span> requires
              <span class="math-inline">$d$</span>'s magnitude to properly fuse
              depth with ray direction.
            </p>
          </div>
        </div>
        <!-- Right Column: Equations & Visuals -->
        <div class="right-col">
          <!-- Key Equation Block -->
          <div class="equation-display" style="padding-top: 5px">
            <div class="math-main">P = t + D(u, v) d</div>
            <div class="math-sub">
              <span style="font-size: 12px">P</span
              ><span style="font-size: 12px"> (3D Point) = </span
              ><span style="font-size: 12px">t</span
              ><span style="font-size: 12px"> (Ray Origin) + </span
              ><span style="font-size: 12px">D</span
              ><span style="font-size: 12px"> (Depth) Ã— </span
              ><span style="font-size: 12px">d</span
              ><span style="font-size: 12px"> (Direction)</span>
            </div>
          </div>
          <!-- Geometric Visualization -->
          <div class="diagram-container">
            <h3
              class="text-sm font-bold text-gray-500 uppercase mb-2 text-center"
            >
              Geometric Derivation
            </h3>
            <canvas
              id="geometryCanvas"
              width="500"
              height="397"
              style="padding-top: 0px; padding-bottom: 0px"
            ></canvas>
            <div class="mt-2 text-center">
              <p class="text-xs text-gray-500 italic">
                The direction d&nbsp; derived via backprojection: d = R K^{-1} p
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Canvas drawing for geometry diagram
      const canvas = document.getElementById("geometryCanvas");
      const ctx = canvas.getContext("2d");

      // Set canvas size
      const container = canvas.parentElement;
      canvas.width = container.offsetWidth;
      canvas.height = container.offsetHeight - 40; // subtract text height

      // Colors
      const colors = {
        origin: "#EF4444", // red-500
        ray: "#22C55E", // green-500
        depth: "#2563EB", // blue-600
        point: "#1E293B", // slate-800
        plane: "#CBD5E1", // slate-300
      };

      function drawDiagram() {
        const w = canvas.width;
        const h = canvas.height;
        const centerX = w * 0.2;
        const centerY = h * 0.5;

        ctx.clearRect(0, 0, w, h);

        // Coordinate System Origin (Camera Center t)
        ctx.beginPath();
        ctx.arc(centerX, centerY, 6, 0, 2 * Math.PI);
        ctx.fillStyle = colors.origin;
        ctx.fill();
        ctx.font = "bold 14px Roboto Mono";
        ctx.fillStyle = colors.origin;
        ctx.fillText("t (Origin)", centerX - 20, centerY - 15);

        // Image Plane
        const planeDist = 80;
        const planeH = 120;

        ctx.beginPath();
        ctx.moveTo(centerX + planeDist, centerY - planeH / 2);
        ctx.lineTo(centerX + planeDist + 20, centerY - planeH / 2 - 20); // perspective skew
        ctx.lineTo(centerX + planeDist + 20, centerY + planeH / 2 - 20);
        ctx.lineTo(centerX + planeDist, centerY + planeH / 2);
        ctx.closePath();
        ctx.strokeStyle = colors.plane;
        ctx.lineWidth = 2;
        ctx.fillStyle = "rgba(226, 232, 240, 0.3)";
        ctx.fill();
        ctx.stroke();

        // Pixel p on image plane
        const pixelY = centerY - 20; // slightly up
        ctx.beginPath();
        ctx.arc(centerX + planeDist + 5, pixelY, 3, 0, 2 * Math.PI);
        ctx.fillStyle = "#64748B";
        ctx.fill();
        ctx.fillStyle = "#64748B";
        ctx.fillText("p", centerX + planeDist + 10, pixelY - 5);

        // Ray Vector d
        const endX = w * 0.8;
        const endY = centerY - 80; // Projecting out

        // Draw full ray line (dashed for extension)
        ctx.beginPath();
        ctx.setLineDash([5, 5]);
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(endX, endY);
        ctx.strokeStyle = "#94A3B8";
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.setLineDash([]);

        // Draw Direction Vector d (arrow)
        const dLen = 100;
        const angle = Math.atan2(endY - centerY, endX - centerX);
        const dX = centerX + Math.cos(angle) * dLen;
        const dY = centerY + Math.sin(angle) * dLen;

        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(dX, dY);
        ctx.strokeStyle = colors.ray;
        ctx.lineWidth = 3;
        ctx.stroke();

        // Arrowhead for d
        ctx.beginPath();
        ctx.moveTo(dX, dY);
        ctx.lineTo(
          dX - 10 * Math.cos(angle - Math.PI / 6),
          dY - 10 * Math.sin(angle - Math.PI / 6),
        );
        ctx.lineTo(
          dX - 10 * Math.cos(angle + Math.PI / 6),
          dY - 10 * Math.sin(angle + Math.PI / 6),
        );
        ctx.fillStyle = colors.ray;
        ctx.fill();
        ctx.fillStyle = colors.ray;
        ctx.fillText("d", dX + 5, dY + 20);

        // 3D Point P
        ctx.beginPath();
        ctx.arc(endX, endY, 6, 0, 2 * Math.PI);
        ctx.fillStyle = colors.point;
        ctx.fill();
        ctx.font = "bold 16px Roboto Mono";
        ctx.fillStyle = colors.point;
        ctx.fillText("P (World Point)", endX - 100, endY - 15);

        // Depth Label D
        const midX = (centerX + endX) / 2;
        const midY = (centerY + endY) / 2;
        ctx.font = "bold 14px Roboto Mono";
        ctx.fillStyle = colors.depth;
        ctx.fillText("Depth D", midX - 20, midY + 30);
      }

      // Draw immediately
      drawDiagram();
    </script>
    <script>
      // Initialize KaTeX auto-render
      document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
          ],
          throwOnError: false,
        });
      });
    </script>
  </body>
</html>
